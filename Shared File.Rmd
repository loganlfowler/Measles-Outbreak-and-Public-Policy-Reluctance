---
title: "Measles Outbreak & Public Policy Reluctance"
author: "Logan Fowler"
date: "2025-09-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(sf)
library(tigris)
library(janitor)
library(lubridate)
library(viridis)
options(tigris_use_cache = TRUE)
```

``` {r}
measles <- read_csv("measles_county_all_updates.csv") %>%
  clean_names()
glimpse(measles)
```

```{r}
#aggregate data
year_to_map <- 2025
measles_cnty <- measles %>%
  filter(location_type == "county") %>%
  mutate(date = ymd(date),
         fips = str_pad(as.character(location_id), 5, pad = "0")) %>%
  filter(year(date) == year_to_map,
         outcome_type %in% c("case_lab-confirmed", "case_probable")) %>%
  group_by(fips) %>%
  summarize(cases = sum(value, na.rm = TRUE), .groups = "drop")

#county shapes
counties_sf <- tigris::counties(cb = TRUE, year = 2023) %>%
  filter(!STATEFP %in% c("60","66","69","72","78")) %>%
  select(GEOID, NAME, STATEFP, geometry) %>%
  st_as_sf() %>%
  st_transform(5070)

#outbreak map
county_centroids <- st_centroid(counties_sf) %>%
  select(GEOID)
case_points <- county_centroids %>%
  left_join(measles_cnty, by = c("GEOID" = "fips")) %>%
  filter(!is.na(cases) & cases > 0)

ggplot() +
  geom_sf(data = counties_sf, fill = "grey90", color = NA) +
  
  geom_sf(data = case_points,
          aes(size = cases),
          shape = 21, fill = "white", color = "black", alpha = 0.8) +
  
  scale_size_area(max_size = 7, name = "Measles cases") +
  
  coord_sf() +
  labs(
    title = paste("US Measles Outbreaks,", year_to_map),
    subtitle = "Bubble size = total confirmed cases per county",
    caption = "Data source: measles_county_all_updates.csv"
  ) +
  theme_void(base_size = 12) +
  theme(plot.title = element_text(face = "bold"))
```
